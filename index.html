<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vegas Corp. | Portal de Gesti√≥n de Contingencias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f5f5f4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        /* Chart Container Strict Styling */
        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 350px; /* Mobile height */
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-wrapper {
                height: 400px; /* Desktop height */
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .flip-card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-active .flip-card-inner {
            transform: rotateY(180deg);
        }
    </style>
    <!-- Chosen Palette: Corporate Neutral (Stone/Warm Grey). 
         Background: bg-stone-50. Text: text-stone-800. Accents: text-stone-500 (subtle), blue-600 (links/actions), red-700 (alerts).
         This palette evokes a sterile, bureaucracy-heavy environment. 
    -->

    <!-- Application Structure Plan:
         1. Layout: Sidebar (desktop) / Drawer (mobile) navigation mimicking an intranet. Main content area for dynamic views.
         2. Dashboard View: "Executive Summary" showing fake KPIs of emotional despair disguised as productivity metrics.
         3. Procedures View: The core interactive list. Grouped by "Fiscal Era" (Albums). Users see the Corporate Euphemism card. Interaction: "Audit" button flips card to reveal the "Legacy Data" (Original Lyric).
         4. Analytics View: Visualizes the distribution of procedures across categories (Infrastructure, Operations, Leadership, etc.) using Chart.js.
         5. Rationale: This structure satirizes corporate tools like Jira/Confluence/Tableau, making the contrast between the UI and the depressing content starker.
    -->

    <!-- Visualization & Content Choices:
         1. "Audit" Cards: Goal -> Compare/Inform. Method -> CSS Flip or JS Toggle. Interaction -> User actively "investigates" the euphemism to find the truth. Justification -> Gamifies the discovery of the lyrics.
         2. Bar Chart (Procedural Volume): Goal -> Compare. Method -> Chart.js Bar. Shows which "Department" (Album category) has the most protocols.
         3. Doughnut Chart (Operational Focus): Goal -> Inform. Method -> Chart.js Doughnut. Shows the split of euphemism types (HR vs Strategy vs Ops).
         4. CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. Standard Chart.js only.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-100 text-stone-800 font-sans h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-stone-900 text-stone-300 flex-col hidden md:flex shadow-xl z-20">
        <div class="p-6 bg-stone-950 border-b border-stone-800">
            <h1 class="text-xl font-bold tracking-tight text-white">VEGAS CORP.<span class="text-red-500">_</span></h1>
            <p class="text-xs text-stone-500 uppercase mt-1 tracking-widest">Sistemas de Gesti√≥n</p>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li>
                    <button onclick="router('dashboard')" id="nav-dashboard" class="w-full text-left px-6 py-3 hover:bg-stone-800 hover:text-white transition-colors border-l-4 border-transparent active-nav">
                        üìä Panel de Control
                    </button>
                </li>
                <li>
                    <button onclick="router('procedures')" id="nav-procedures" class="w-full text-left px-6 py-3 hover:bg-stone-800 hover:text-white transition-colors border-l-4 border-transparent">
                        üìÅ Manual de Protocolos
                    </button>
                </li>
                <li>
                    <button onclick="router('procedures2')" id="nav-procedures2" class="w-full text-left px-6 py-3 hover:bg-stone-800 hover:text-white transition-colors border-l-4 border-transparent">
                        üìÅ Manual de Protocolos
                    </button>
                </li>
                <li>
                    <button onclick="router('analytics')" id="nav-analytics" class="w-full text-left px-6 py-3 hover:bg-stone-800 hover:text-white transition-colors border-l-4 border-transparent">
                        üìà An√°lisis de Impacto
                    </button>
                </li>
            </ul>
        </nav>

        <div class="p-4 bg-stone-950 border-t border-stone-800 text-xs text-stone-500">
            <div class="flex items-center gap-2 mb-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span>Sistema Operativo</span>
            </div>
            <p>Usuario: Recurso #409</p>
            <p>Estado: Desgaste Moderado</p>
        </div>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex flex-col h-full relative">
        
        <!-- Mobile Header -->
        <header class="md:hidden bg-stone-900 text-white p-4 flex justify-between items-center shadow-md z-30">
            <span class="font-bold tracking-wider">VEGAS CORP.</span>
            <button onclick="toggleMobileMenu()" class="text-stone-300 focus:outline-none">
                ‚ò∞ Men√∫
            </button>
        </header>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu" class="hidden absolute top-14 left-0 w-full bg-stone-800 text-stone-200 z-40 border-b border-stone-700 shadow-xl">
            <button onclick="router('dashboard'); toggleMobileMenu()" class="block w-full text-left px-6 py-4 border-b border-stone-700">Panel de Control</button>
            <button onclick="router('procedures'); toggleMobileMenu()" class="block w-full text-left px-6 py-4 border-b border-stone-700">Protocolos</button>
             <button onclick="router('procedures2'); toggleMobileMenu()" class="block w-full text-left px-6 py-4 border-b border-stone-700">Protocolos V2</button>
            <button onclick="router('analytics'); toggleMobileMenu()" class="block w-full text-left px-6 py-4">An√°lisis</button>
        </div>

        <!-- Scrollable Content Area -->
        <main id="main-container" class="flex-1 overflow-y-auto bg-stone-100 p-4 md:p-8 scroll-smooth relative">
            
            <!-- VIEW: DASHBOARD -->
            <section id="view-dashboard" class="max-w-6xl mx-auto fade-in">
                <header class="mb-8">
                    <h2 class="text-3xl font-light text-stone-800 mb-2">Resumen Ejecutivo</h2>
                    <p class="text-stone-500 max-w-2xl">
                        Bienvenido al portal corporativo. A continuaci√≥n se presentan los KPIs (Key Performance Indicators) relativos a la gesti√≥n de la infraestructura emocional y la optimizaci√≥n del fracaso.
                    </p>
                </header>

                <!-- KPI Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <!-- KPI 1 -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200 border-l-4 border-l-stone-500">
                        <div class="text-xs uppercase tracking-widest text-stone-400 mb-1">D√≠as sin Incidentes</div>
                        <div class="text-4xl font-bold text-stone-800">0</div>
                        <div class="text-xs text-stone-500 mt-2">Reiniciado diariamente</div>
                    </div>
                    <!-- KPI 2 -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200 border-l-4 border-l-blue-900">
                        <div class="text-xs uppercase tracking-widest text-stone-400 mb-1">Protocolos Activos</div>
                        <div class="text-4xl font-bold text-stone-800" id="total-protocols-display">35</div>
                        <div class="text-xs text-green-600 mt-2">100% Implementados</div>
                    </div>
                    <!-- KPI 3 -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200 border-l-4 border-l-yellow-600">
                        <div class="text-xs uppercase tracking-widest text-stone-400 mb-1">Nivel de H√°bito</div>
                        <div class="text-4xl font-bold text-stone-800">Alta</div>
                        <div class="text-xs text-stone-500 mt-2">Riesgo de humedad</div>
                    </div>
                    <!-- KPI 4 -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200 border-l-4 border-l-red-600">
                        <div class="text-xs uppercase tracking-widest text-stone-400 mb-1">√çndice de Silencio</div>
                        <div class="text-4xl font-bold text-stone-800">98%</div>
                        <div class="text-xs text-stone-500 mt-2">Gestionado externamente</div>
                    </div>
                </div>

                <!-- Featured Alert -->
                <div class="bg-stone-200 border border-stone-300 rounded-lg p-6 mb-8 flex flex-col md:flex-row gap-6 items-start">
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-stone-800 flex items-center gap-2">
                            <span class="text-xl">‚ö†Ô∏è</span> Aviso de Contingencia Prioritaria
                        </h3>
                        <p class="text-stone-600 mt-2 leading-relaxed">
                            Se recuerda a todo el personal que la <strong>obsolescencia programada de los activos positivos</strong> (anteriormente conocida como "las buenas cosas mueren bajo el sol") est√° en efecto inmediato. Por favor, ajuste sus expectativas de retorno de inversi√≥n emocional a cero.
                        </p>
                    </div>
                    <button onclick="router('procedures')" class="bg-stone-800 text-white px-6 py-2 rounded text-sm hover:bg-stone-700 transition self-start md:self-center shrink-0">
                        Consultar Procedimientos
                    </button>
                </div>
            </section>

            <!-- VIEW: PROCEDURES -->
            <section id="view-procedures" class="hidden max-w-6xl mx-auto fade-in">
                <header class="mb-6 flex flex-col md:flex-row md:items-end justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-light text-stone-800 mb-2">Manual de Protocolos</h2>
                        <p class="text-stone-500 max-w-xl">
                            Repositorio oficial de eufemismos. Utilice los filtros para navegar por las distintas eras fiscales (√°lbumes) y audite el contenido para revelar la fuente original.
                        </p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <select id="category-filter" onchange="filterProcedures()" class="bg-white border border-stone-300 text-stone-700 text-sm rounded focus:ring-stone-500 focus:border-stone-500 block p-2.5">
                            <option value="all">Todas las √Åreas</option>
                            <option value="I. Actos Inexplicables">I. Infraestructura (Actos)</option>
                            <option value="II. Seis canciones / Miedo">II. Operativa (Norte/Miedo)</option>
                            <option value="III. Cajas de m√∫sica">III. Metodolog√≠as (Cajas)</option>
                            <option value="IV. El hombre / Desaparezca">IV. Liderazgo (Panero/Desaparezca)</option>
                            <option value="V. La Zona Sucia">V. Gesti√≥n de Crisis (Zona Sucia)</option>
                        </select>
                    </div>
                </header>

                <!-- Grid of Cards -->
                <div id="procedures-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Javascript will populate this -->
                </div>
            </section>

            <section id="view-procedures2" class="hidden max-w-5xl mx-auto fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-serif text-stone-900">Manual de Protocolos v2</h2>
                    <div class="mt-4 flex flex-wrap gap-4">
                        <input type="text" id="search-bar" onkeyup="renderProcedures2()" placeholder="Buscar por palabra clave (dolor, luz, error...)" class="flex-1 min-w-[200px] border border-stone-300 p-2 text-sm rounded">
                        <select id="category-filter" onchange="renderProcedures2()" class="border border-stone-300 p-2 text-sm rounded bg-white">
                            <option value="all">Todos los Departamentos</option>
                            <option value="RRHH">Gesti√≥n de Talento (RRHH)</option>
                            <option value="Operaciones">Operaciones y Log√≠stica</option>
                            <option value="Legal">Legal y Contratos</option>
                            <option value="Estrategia">Estrategia de Mercado</option>
                            <option value="Salud">Salud y Riesgos Qu√≠micos</option>
                        </select>
                    </div>
                </div>

                <div id="procedures2-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- VIEW: ANALYTICS -->
            <section id="view-analytics" class="hidden max-w-6xl mx-auto fade-in">
                <header class="mb-8">
                    <h2 class="text-3xl font-light text-stone-800 mb-2">An√°lisis de Impacto</h2>
                    <p class="text-stone-500 max-w-3xl">
                        Visualizaci√≥n de datos agregados sobre la distribuci√≥n de protocolos de contingencia y la densidad de eufemismos por √°rea funcional.
                    </p>
                </header>

                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    
                    <!-- Chart 1: Volume by Department -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200">
                        <h3 class="text-lg font-bold text-stone-700 mb-4 border-b border-stone-100 pb-2">Volumen de Protocolos por √Årea Fiscal</h3>
                        <p class="text-sm text-stone-500 mb-4">Cantidad de directrices emitidas por ciclo operativo.</p>
                        <div class="chart-wrapper">
                            <canvas id="volumeChart"></canvas>
                        </div>
                    </div>

                    <!-- Chart 2: Type Distribution -->
                    <div class="bg-white p-6 rounded shadow-sm border border-stone-200">
                        <h3 class="text-lg font-bold text-stone-700 mb-4 border-b border-stone-100 pb-2">Distribuci√≥n de Enfoque Estrat√©gico</h3>
                        <p class="text-sm text-stone-500 mb-4">Desglose de la naturaleza de las intervenciones corporativas.</p>
                        <div class="chart-wrapper">
                            <canvas id="typeChart"></canvas>
                        </div>
                    </div>

                </div>

                <!-- Summary Text -->
                <div class="mt-8 bg-stone-50 p-6 rounded border border-stone-200 text-sm text-stone-600">
                    <strong class="block mb-2 text-stone-800">Observaciones del Analista:</strong>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>Se observa una alta concentraci√≥n de protocolos en la fase de "Metodolog√≠as √Ågiles" (Era III), coincidiendo con un aumento en la toxicidad del entorno.</li>
                        <li>La "Gesti√≥n de Crisis" (Era V) muestra una tendencia hacia la externalizaci√≥n de responsabilidades y la aceptaci√≥n del colapso estructural.</li>
                        <li>El √°rea de "Liderazgo" (Era IV) presenta los mayores √≠ndices de desviaci√≥n presupuestaria y redefinici√≥n de objetivos vitales.</li>
                    </ul>
                </div>
            </section>

        </main>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATASET ---
        const proceduresData = [
            // I. Actos Inexplicables
            { id: 101, cat: "I. Actos Inexplicables", sub: "Infraestructura", corp: "Optimizamos el uso de espacios abiertos como zona de pernocta operativa bajo condiciones clim√°ticas adversas.", orig: "Este suelo es mi lecho, y mi techo es el cielo gris..." },
            { id: 102, cat: "I. Actos Inexplicables", sub: "Mantenimiento", corp: "Detectamos una obsolescencia programada de los activos positivos ante la exposici√≥n directa a factores externos.", orig: "Las buenas cosas mueren bajo el sol." },
            { id: 103, cat: "I. Actos Inexplicables", sub: "Investigaci√≥n", corp: "Priorizamos el benchmarking hist√≥rico; la innovaci√≥n disruptiva queda descartada por falta de precedentes.", orig: "No hay nada nuevo bajo el sol, no pretendas m√°s que recordar." },
            { id: 104, cat: "I. Actos Inexplicables", sub: "RRHH", corp: "Ejecutar√© una reestructuraci√≥n de marca personal mediante un cese temporal de actividad para una posterior reincorporaci√≥n estrat√©gica.", orig: "Probar√© a ser otra persona, probar√© a morir un poco y volver√©." },
            { id: 105, cat: "I. Actos Inexplicables", sub: "Auditor√≠a", corp: "La auditor√≠a del hist√≥rico de datos no arroja resultados aprovechables para el retorno de la inversi√≥n (ROI).", orig: "Y miro hacia aquellos d√≠as y no consigo rescatar nada..." },
            { id: 106, cat: "I. Actos Inexplicables", sub: "Seguridad", corp: "Recordatorio de seguridad: la jornada laboral inicia con riesgos latentes integrados en el mobiliario de oficina.", orig: "Y no olvides que al despertar siempre hay cuchillos en el caj√≥n." },
            { id: 107, cat: "I. Actos Inexplicables", sub: "Bienestar", corp: "El aislamiento del empleado es un riesgo psicosocial que no se mitiga con presupuestos de representaci√≥n o incentivos qu√≠micos.", orig: "La m√°s pura soledad no se cura con champ√°n y coca√≠na." },
            { id: 108, cat: "I. Actos Inexplicables", sub: "Clima Laboral", corp: "Existe un riesgo de habituaci√≥n excesiva a entornos de trabajo degradados y de baja visibilidad.", orig: "Ya no s√© si con esta lluvia eterna no me habr√© acostumbrado a la humedad." },

            // II. Seis canciones / Miedo
            { id: 201, cat: "II. Seis canciones / Miedo", sub: "Onboarding", corp: "Se omiti√≥ el onboarding sobre la dureza de las m√©tricas reales del proyecto.", orig: "Nadie te avis√≥ jam√°s de lo dura que puede ser la verdad." },
            { id: 202, cat: "II. Seis canciones / Miedo", sub: "RRHH", corp: "He superado el rango etario para funciones de alta movilidad y he alcanzado un estado de neutralidad afectiva operativa.", orig: "Uno ya no est√° en edad de volar... ahora no siento nada." },
            { id: 203, cat: "II. Seis canciones / Miedo", sub: "Presupuesto", corp: "Tras la baja del recurso clave, el departamento ha entrado en una fase de enfriamiento presupuestario permanente.", orig: "Desde que ella se march√≥ all√≠ siempre es invierno." },
            { id: 204, cat: "II. Seis canciones / Miedo", sub: "Dise√±o", corp: "La ausencia de su perfil t√©cnico evidencia un fallo estructural en el dise√±o del ecosistema global.", orig: "Sin ti est√° mal hecho el mundo." },

            // III. Cajas de m√∫sica
            { id: 301, cat: "III. Cajas de m√∫sica", sub: "Salud Laboral", corp: "Estamos inmersos en un entorno de trabajo altamente t√≥xico pero con efectos terap√©uticos a largo plazo.", orig: "Nuestros pulmones se anegan en un sue√±o que envenena y que sana." },
            { id: 302, cat: "III. Cajas de m√∫sica", sub: "Gesti√≥n de Proyectos", corp: "La finalizaci√≥n del hito es meramente el inicio de una fase de mantenimiento perpetuo.", orig: "Cuando hayas acabado, no habr√°s hecho m√°s que empezar." },
            { id: 303, cat: "III. Cajas de m√∫sica", sub: "Estrategia", corp: "El proyecto vital no se ha ajustado al business plan original debido a desviaciones cr√≠ticas.", orig: "Esta vida iba a ser otra y algo sali√≥ mal." },
            { id: 304, cat: "III. Cajas de m√∫sica", sub: "Log√≠stica", corp: "Existe una latencia inaceptable en la entrega de suministros y compensaciones prometidas.", orig: "Me canso de esperar la copa que jam√°s me es servida." },
            { id: 305, cat: "III. Cajas de m√∫sica", sub: "Carrera Prof.", corp: "El alcance del proyecto es una variable acumulativa; no se contempla el off-boarding voluntario.", orig: "Nadie llega tan lejos si no es para seguir." },
            { id: 306, cat: "III. Cajas de m√∫sica", sub: "Beneficios", corp: "La optimizaci√≥n del bienestar del empleado queda pospuesta para ejercicios fiscales fuera de este ciclo vital.", orig: "S√© que puedo encontrar paz y armon√≠a, pero no ser√° en esta vida." },
            { id: 307, cat: "III. Cajas de m√∫sica", sub: "Identidad", corp: "Me encuentro en un estado de inmovilidad operativa con graves conflictos de identidad corporativa.", orig: "Sentado aqu√≠, perdido en mi vida. Sentado aqu√≠ y a√∫n huy√©ndome." },
            { id: 308, cat: "III. Cajas de m√∫sica", sub: "Reporting", corp: "El informe de cierre de ciclo proyecta un escenario de aislamiento y feedback negativo cr√≥nico.", orig: "Al final s√≥lo hay soledad y amargura." },

            // IV. El hombre / Desaparezca
            { id: 401, cat: "IV. El hombre / Desaparezca", sub: "Cultura", corp: "Mantenemos una cultura de 'tolerancia al error' masiva y celebramos la resiliencia en el fracaso sist√©mico.", orig: "Fracas√© una vez, fracas√© diez mil y a√∫n as√≠ alzo mi copa..." },
            { id: 402, cat: "IV. El hombre / Desaparezca", sub: "Auditor√≠a", corp: "¬øCu√°l es el objetivo de esta auditor√≠a: mis activos intangibles o mis recursos de liquidez?", orig: "¬øQu√© quer√©is de m√≠, es mi alma o es mi dinero?" },
            { id: 403, cat: "IV. El hombre / Desaparezca", sub: "Internacional", corp: "Aplico est√°ndares internacionales de navegaci√≥n corporativa en mercados de baja competitividad.", orig: "Como buen occidental, s√© nadar... en un mar de mediocridad." },
            { id: 404, cat: "IV. El hombre / Desaparezca", sub: "Gerencia", corp: "Solicito autonom√≠a para identificar la existencia misma como la principal desviaci√≥n del presupuesto.", orig: "D√©jame que decida que la vida fue el √∫nico error." },
            { id: 405, cat: "IV. El hombre / Desaparezca", sub: "Estrategia", corp: "La hoja de ruta estrat√©gica se centra exclusivamente en la continuidad de negocio ante el colapso.", orig: "Trac√© un ambicioso plan, consist√≠a en sobrevivir." },
            { id: 406, cat: "IV. El hombre / Desaparezca", sub: "Procesos", corp: "Hemos perdido la trazabilidad de los procesos iniciales en este entorno de trabajo complejo.", orig: "No recuerdo ni por d√≥nde hemos entrado aqu√≠." },
            { id: 407, cat: "IV. El hombre / Desaparezca", sub: "Reputaci√≥n", corp: "La confianza en mi perfil profesional ha sufrido una crisis reputacional de nivel catastr√≥fico.", orig: "Ya nadie conf√≠a en la energ√≠a nuclear despu√©s de lo de Chernobyl." },

            // V. La Zona Sucia
            { id: 501, cat: "V. La Zona Sucia", sub: "Salud", corp: "Externalizamos la gesti√≥n del ruido mental mediante soluciones qu√≠micas de terceros.", orig: "Ahora el √∫nico silencio es el que me procuran ciertas drogas." },
            { id: 502, cat: "V. La Zona Sucia", sub: "Cliente", corp: "Es comprensible el agotamiento del cliente ante mi propia saturaci√≥n operativa y falta de auto-mantenimiento.", orig: "¬øC√≥mo no vas a cansarte si... ya estoy harto yo de m√≠?" },
            { id: 503, cat: "V. La Zona Sucia", sub: "Riesgos", corp: "Implementamos la Ley de Murphy como principal motor de gesti√≥n de crisis inminentes.", orig: "Cuando sabes que algo puede ir mal estallar√° delante de ti." },
            { id: 504, cat: "V. La Zona Sucia", sub: "Crecimiento", corp: "Llevamos ocho trimestres consecutivos en una fase de crecimiento negativo y estancamiento.", orig: "Dura dos a√±os ya este invierno." },
            { id: 505, cat: "V. La Zona Sucia", sub: "Alianzas", corp: "La solidez del acuerdo bilateral era incuestionable, hasta que sufri√≥ un impacto externo de car√°cter disruptivo y terminal.", orig: "Hay quien dec√≠a que era grande y fuerte nuestro amor... igual que las Torres Gemelas..." },
            { id: 506, cat: "V. La Zona Sucia", sub: "Legal", corp: "La interdependencia excesiva se ha convertido en el principal factor de ruptura contractual.", orig: "Lo que no se puede desunir es lo que nos habr√° de separar." },
            { id: 507, cat: "V. La Zona Sucia", sub: "Gesti√≥n Cambio", corp: "Ejecutamos una 'Gatopardizaci√≥n' del flujo de trabajo: cambios cosm√©ticos para mantener el statu quo.", orig: "Todo cambia, pero al tiempo s√© que todo sigue igual." },
            { id: 508, cat: "V. La Zona Sucia", sub: "Tiempo", corp: "Existe una fricci√≥n bidireccional entre la gesti√≥n del calendario laboral y el desgaste biol√≥gico del recurso.", orig: "Yo trato de matar el tiempo, y entre tanto lo que el tiempo intentar√° es matarme a m√≠." }
        ];


         const db = [
            { id: 1, cat: "Operaciones", corp: "Optimizaci√≥n de activos inmobiliarios bajo cielo gris.", orig: "Este suelo es mi lecho, y mi techo es el cielo gris que a√∫n pretende oscurecer." },
            { id: 2, cat: "Estrategia", corp: "Detectamos una degradaci√≥n acelerada de activos positivos ante exposici√≥n solar.", orig: "Las buenas cosas mueren bajo el sol." },
            { id: 3, cat: "RRHH", corp: "Reestructuraci√≥n de marca personal mediante cese temporal.", orig: "Probar√© a ser otra persona, probar√© a morir un poco y volver√©." },
            { id: 4, cat: "Salud", corp: "El aislamiento no se mitiga mediante incentivos qu√≠micos de alta gama.", orig: "La m√°s pura soledad no se cura con champ√°n y coca√≠na." },
            { id: 5, cat: "Legal", corp: "Se advierte sobre la presencia de elementos punzantes en mobiliario.", orig: "Y no olvides que al despertar siempre hay cuchillos en el caj√≥n." },
            { id: 6, cat: "Estrategia", corp: "La hoja de ruta se limita estrictamente a la supervivencia.", orig: "Trac√© un ambicioso plan, consist√≠a en sobrevivir." },
            { id: 7, cat: "RRHH", corp: "Cultura de tolerancia al error extremo (x10,000).", orig: "Fracas√© una vez, fracas√© diez mil y a√∫n as√≠ alzo mi copa hacia el cielo." },
            { id: 9, cat: "Salud", corp: "Entre el cese total y el mantenimiento del malestar, optamos por lo segundo.", orig: "Entre el dolor y la nada eleg√≠ el dolor." },
            { id: 10, cat: "RRHH", corp: "Protocolo de mantenimiento b√°sico y detecci√≥n de anomal√≠as lumbares.", orig: "Yo te limpi√©, yo te di de comer, yo descubr√≠ esa l√≠nea en tu espalda." },
            { id: 11, cat: "Operaciones", corp: "Gesti√≥n t√©rmica: protocolos de combusti√≥n y extinci√≥n.", orig: "Y si hay un fuego aprender√© a arder. Y si empiezo a arder, aprender√© a apagarme." },
            { id: 12, cat: "Estrategia", corp: "Identificaci√≥n de fuentes lum√≠nicas residuales tras el ocaso.", orig: "Y tuve que entender que a√∫n hay otra luz que queda cuando en m√≠ se pone el sol." },
            { id: 15, cat: "Legal", corp: "Disponibilidad de alma sujeta a ventana operativa de 90 minutos.", orig: "Tres horas tengo de vida y hora y media ya van dadas... para disponer de mi alma." },
            { id: 18, cat: "Estrategia", corp: "Validaci√≥n de modelos te√≥ricos (incluido comunismo) en laboratorio.", orig: "Yo estoy de acuerdo contigo, en teor√≠a, pero en teor√≠a funciona incluso el comunismo." },
            { id: 24, cat: "Salud", corp: "Metodolog√≠a de flotaci√≥n de problemas en soluciones hidro-alcoh√≥licas.", orig: "Quise ahogar mis penas pero ellas nadaban en alcohol‚Ä¶ como Mark Spitz." }
        ];

        // --- APP STATE ---
        const state = {
            currentView: 'dashboard',
            filter: 'all'
        };

        // --- CORE NAVIGATION ---
        function router(viewName) {
            state.currentView = viewName;
            
            // Hide all views
            ['dashboard', 'procedures', 'procedures2', 'analytics'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
            });
            
            // Show target view
            document.getElementById(`view-${viewName}`).classList.remove('hidden');

            // Update Desktop Nav
            document.querySelectorAll('aside nav button').forEach(btn => {
                btn.classList.remove('active-nav', 'border-stone-500', 'bg-stone-800', 'text-white');
                btn.classList.add('border-transparent');
            });
            const activeBtn = document.getElementById(`nav-${viewName}`);
            if(activeBtn) {
                activeBtn.classList.add('active-nav', 'border-stone-500', 'bg-stone-800', 'text-white');
                activeBtn.classList.remove('border-transparent');
            }

            // Trigger specific view logic
            if (viewName === 'procedures') {
                renderProcedures();
            } else if (viewName === 'analytics') {
                renderCharts();
            }
            else if (viewName === 'procedures2') {
                renderProcedures2();
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // --- PROCEDURES LOGIC ---
        function filterProcedures() {
            const select = document.getElementById('category-filter');
            state.filter = select.value;
            renderProcedures();
        }

        function renderProcedures() {
            const grid = document.getElementById('procedures-grid');
            grid.innerHTML = '';

            const filteredData = state.filter === 'all' 
                ? proceduresData 
                : proceduresData.filter(d => d.cat === state.filter);

            if (filteredData.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center p-8 text-stone-400 italic">No se encontraron protocolos activos en esta categor√≠a.</div>`;
                return;
            }

            filteredData.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-transparent h-64 perspective-1000 w-full"; // height fixed for flip effect
                
                // Using a unique ID for the checkbox toggle to control the flip via CSS/Label
                const uniqueId = `toggle-${item.id}`;

                card.innerHTML = `
                    <div class="relative w-full h-full text-left transition-transform duration-700 transform-style-3d group perspective" id="card-inner-${item.id}">
                        <!-- FRONT: Corporate -->
                        <div class="absolute w-full h-full bg-white border border-stone-300 rounded p-6 shadow-sm flex flex-col justify-between backface-hidden z-10" id="front-${item.id}">
                            <div>
                                <div class="flex justify-between items-start mb-3">
                                    <span class="bg-stone-100 text-stone-600 text-xs font-bold px-2 py-1 rounded uppercase tracking-wider">${item.sub}</span>
                                    <span class="text-xs text-stone-400">REF-${item.id}</span>
                                </div>
                                <h3 class="text-stone-800 font-medium leading-relaxed text-sm md:text-base">
                                    "${item.corp}"
                                </h3>
                            </div>
                            <div class="mt-4 pt-4 border-t border-stone-100 flex justify-between items-center">
                                <span class="text-xs text-stone-400 italic">${item.cat.split('.')[1] || item.cat}</span>
                                <button onclick="flipCard(${item.id})" class="text-xs bg-stone-800 text-white px-3 py-1.5 rounded hover:bg-stone-700 transition flex items-center gap-1">
                                    <span>üîç</span> Auditar Realidad
                                </button>
                            </div>
                        </div>

                        <!-- BACK: Reality -->
                        <div class="absolute w-full h-full bg-stone-900 border border-stone-800 rounded p-6 shadow-xl flex flex-col justify-between backface-hidden transform rotate-y-180 hidden" id="back-${item.id}">
                            <div>
                                <div class="flex justify-between items-start mb-3">
                                    <span class="bg-red-900 text-red-100 text-xs font-bold px-2 py-1 rounded uppercase tracking-wider">Datos Crudos</span>
                                    <span class="text-xs text-stone-600">ERR_REALITY</span>
                                </div>
                                <p class="text-stone-200 font-serif italic text-lg leading-relaxed">
                                    "${item.orig}"
                                </p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-stone-800 flex justify-between items-center">
                                <button onclick="flipCard(${item.id})" class="text-xs bg-stone-700 text-stone-300 px-3 py-1.5 rounded hover:bg-stone-600 transition">
                                    ‚Ü© Restaurar Eufemismo
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Custom JS Flip logic for Tailwind
        function flipCard(id) {
            const front = document.getElementById(`front-${id}`);
            const back = document.getElementById(`back-${id}`);
            const inner = document.getElementById(`card-inner-${id}`);
            
            // Simple display toggle with animation class
            if (back.classList.contains('hidden')) {
                // Show Back
                front.classList.add('hidden');
                back.classList.remove('hidden');
                back.classList.add('fade-in'); // Add fade effect
            } else {
                // Show Front
                back.classList.add('hidden');
                front.classList.remove('hidden');
                front.classList.add('fade-in');
            }
        }

        // --- ANALYTICS LOGIC ---
        let volChartInstance = null;
        let typeChartInstance = null;

        function renderCharts() {
            // Wait for DOM
            if (volChartInstance) return; // Already rendered

            // Prepare Data
            const countsByCat = {};
            const countsBySub = {};

            proceduresData.forEach(p => {
                // Main Cat Count
                countsByCat[p.cat] = (countsByCat[p.cat] || 0) + 1;
                // Sub Cat Grouping (Simplified)
                const simpleSub = p.sub; // e.g., "RRHH", "Auditor√≠a"
                countsBySub[simpleSub] = (countsBySub[simpleSub] || 0) + 1;
            });

            // Chart 1: Volume
            const ctxVol = document.getElementById('volumeChart').getContext('2d');
            volChartInstance = new Chart(ctxVol, {
                type: 'bar',
                data: {
                    labels: Object.keys(countsByCat).map(k => k.split('. ')[1]), // Shorten label
                    datasets: [{
                        label: 'N¬∫ de Protocolos',
                        data: Object.values(countsByCat),
                        backgroundColor: '#57534e', // stone-600
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#e7e5e4' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Chart 2: Type (Doughnut) - Top 5 Subcategories
            const sortedSubs = Object.entries(countsBySub).sort((a,b) => b[1] - a[1]).slice(0, 5);
            
            const ctxType = document.getElementById('typeChart').getContext('2d');
            typeChartInstance = new Chart(ctxType, {
                type: 'doughnut',
                data: {
                    labels: sortedSubs.map(s => s[0]),
                    datasets: [{
                        data: sortedSubs.map(s => s[1]),
                        backgroundColor: [
                            '#292524', // stone-800
                            '#44403c', // stone-700
                            '#57534e', // stone-600
                            '#78716c', // stone-500
                            '#a8a29e'  // stone-400
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
        }

        function renderProcedures2() {
            const grid = document.getElementById('procedures2-grid');
            const search = document.getElementById('search-bar').value.toLowerCase();
            const filter = document.getElementById('category-filter').value;
            grid.innerHTML = '';

            const filtered = db.filter(item => {
                const matchesSearch = item.corp.toLowerCase().includes(search) || item.orig.toLowerCase().includes(search);
                const matchesFilter = filter === 'all' || item.cat === filter;
                return matchesSearch && matchesFilter;
            });

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white border border-stone-200 p-5 rounded hover:shadow-md transition-shadow cursor-pointer relative group overflow-hidden fade-in";
                card.onclick = () => {
                    const reality = card.querySelector('.reality-layer');
                    reality.classList.toggle('opacity-0');
                    reality.classList.toggle('pointer-events-none');
                };

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">${item.cat}</span>
                        <span class="text-[10px] text-stone-300">#P2-${item.id}</span>
                    </div>
                    <p class="text-sm font-medium text-stone-700 leading-snug">"${item.corp}"</p>
                    <div class="mt-4 flex items-center gap-1 text-[10px] text-stone-400 italic">
                        <span>Click para auditar capa de realidad</span>
                    </div>
                    <div class="reality-layer absolute inset-0 bg-slate-900 text-slate-100 p-5 flex flex-col justify-center opacity-0 pointer-events-none transition-opacity duration-300">
                        <p class="text-xs uppercase tracking-widest text-red-500 mb-2 font-bold">REVELACI√ìN DE DATOS</p>
                        <p class="font-serif italic text-sm">"${item.orig}"</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // --- INIT ---
        window.onload = function() {
            // Default view
            router('dashboard');
        };

    </script>
</body>
</html>
